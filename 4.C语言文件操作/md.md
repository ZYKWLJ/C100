### 读写 API

#### API总览


||||||
|-|-|-|-|-|
|**创建文件**|fopen||||
|**刷新磁盘**|fflush||||
|**关闭文件**|fclose||||
|**写文件**|fwrite|fputc|fputs|fgets|
|**读文件**|fread|fgetc|fprintf|fscanf|

#### API 精讲
||||||
|-|-|-|-|-|
|fopen|||
|签名|FILE *fopen(const char *filename, const char *mode);|
|注意点|mode的值决定了打开的方式，具体如下：|


以下从 **基础原理** 到 **实战细节**，全面精讲 `fopen` 的 `mode` 取值规则与约束，结合跨平台差异、易错场景深入分析：

---

### 一、基础模式：文本 vs 二进制（核心差异）
#### 1. 文本模式（无 `b` 标记）
- **本质**：按**字符流**处理文件，隐含**换行符转换**（仅 Windows 生效）  
- **规则**：  
  - Windows 下：写入 `\n` 会自动转为 `\r\n`；读取 `\r\n` 会自动转为 `\n`  
  - Linux/Mac 下：无转换，`\n` 直接对应系统换行符（Linux 是 `\n`，Mac 历史版本是 `\r`，现代统一为 `\n`）  
- **适用场景**：纯文本文件（`.txt`、代码文件等），需跨平台兼容换行时使用  

#### 2. 二进制模式（带 `b` 标记，如 `rb`/`wb`）
- **本质**：按**字节流**处理文件，**无任何隐式转换**  
- **规则**：  
  - 所有平台（Windows/Linux/Mac）统一按原始字节读写，`\n` 不会被修改  
- **适用场景**：二进制文件（图片、视频、可执行程序、自定义二进制格式）  


### 二、常见 `mode` 组合及行为（读写控制 + 创建逻辑）
以下是 **C语言标准** 定义的核心模式（不同编译器可能有扩展，但通用规则一致）：

| `mode` 值       | 读写权限       | 文件存在时行为               | 文件不存在时行为       | 指针初始位置   | 关键约束/注意点                     |
|-----------------|----------------|------------------------------|------------------------|----------------|-------------------------------------|
| **`r`**         | 只读           | 正常打开，指针到开头         | 报错（返回 `NULL`）    | 文件开头       | 需确保文件已存在                    |
| **`w`**         | 只写           | 清空文件内容（长度截为 0）   | 创建新文件             | 文件开头       | 原有内容会**完全丢失**              |
| **`a`**         | 只写（追加）   | 指针移到文件末尾             | 创建新文件             | 文件末尾       | 写操作只能追加，读需手动移指针      |
| **`r+`**        | 读写           | 正常打开，指针到开头         | 报错（返回 `NULL`）    | 文件开头       | 需确保文件已存在；读写共享一个指针  |
| **`w+`**        | 读写           | 清空文件内容（长度截为 0）   | 创建新文件             | 文件开头       | 原有内容会**完全丢失**；支持读写    |
| **`a+`**        | 读写（追加）   | 指针移到文件末尾（写）       | 创建新文件             | 文件开头（读） | 写操作只能追加，读需手动移指针      |
| **`rb`**        | 只读（二进制） | 正常打开，指针到开头         | 报错（返回 `NULL`）    | 文件开头       | 二进制模式，无换行转换              |
| **`wb`**        | 只写（二进制） | 清空文件内容（长度截为 0）   | 创建新文件             | 文件开头       | 二进制模式，原有内容完全丢失        |
| **`ab`**        | 只写（二进制追加） | 指针移到文件末尾         | 创建新文件             | 文件末尾       | 二进制模式，写操作只能追加          |
| **`r+b`/`rb+`** | 读写（二进制） | 正常打开，指针到开头         | 报错（返回 `NULL`）    | 文件开头       | 二进制模式，需文件已存在            |
| **`w+b`/`wb+`** | 读写（二进制） | 清空文件内容（长度截为 0）   | 创建新文件             | 文件开头       | 二进制模式，原有内容完全丢失        |
| **`a+b`/`ab+`** | 读写（二进制追加） | 指针移到文件末尾         | 创建新文件             | 文件开头（读） | 二进制模式，写操作只能追加          |  


### 三、深度细节：容易踩坑的场景
#### 1. **`w`/`w+` 的“清空”逻辑**  
- 只要用 `w`/`w+` 打开文件，**无论之前有没有内容**，文件会被立即清空（长度设为 0）。  
- 案例：  
  ```c
  FILE *fp = fopen("test.txt", "w");
  fputs("Hello", fp); 
  fclose(fp); 

  // 再次用 w 打开，原有内容被清空
  fp = fopen("test.txt", "w"); 
  fputs("World", fp); // 文件内容变为 "World"
  fclose(fp);
  ```

#### 2. **`a`/`a+` 的“追加”陷阱**  
- **写操作**：永远从文件末尾开始，即使手动用 `fseek` 移动指针，写时仍会跳回末尾。  
- **读操作**：默认指针在开头（`a+` 模式），但写操作会强制指针到末尾，需手动移指针才能读旧内容。  
- 案例：  
  ```c
  FILE *fp = fopen("log.txt", "a+");
  fputs("Append\n", fp); // 写在末尾
  fseek(fp, 0, SEEK_SET); // 手动移到开头准备读
  char buf[100];
  fgets(buf, sizeof(buf), fp); // 能读到文件开头内容
  fclose(fp);
  ```

#### 3. **跨平台的 `b` 标记差异**  
- **Windows**：严格区分文本/二进制模式，`b` 标记决定是否转换换行。  
- **Linux/Mac**：忽略 `b` 标记（因为系统本身无换行转换），但为了代码跨平台，建议**始终显式加 `b`**（如 `rb`/`wb`）。  


### 四、实战对比：文本 vs 二进制模式（代码验证）
#### 1. 文本模式（`w`）写入换行  
```c
FILE *fp = fopen("text.txt", "w");
fputs("Line1\nLine2", fp); // Windows 下实际写入 "Line1\r\nLine2"
fclose(fp);
```  
- Windows 打开文件：显示为 `Line1` 和 `Line2` 两行（因为 `\r\n` 是系统换行）。  
- Linux 打开文件：显示为 `Line1\nLine2`（`\n` 是系统换行）。  


#### 2. 二进制模式（`wb`）写入换行  
```c
FILE *fp = fopen("binary.bin", "wb");
fwrite("Line1\nLine2", 1, 10, fp); // 直接写入原始字节："Line1\nLine2"（无转换）
fclose(fp);
```  
- 用十六进制查看文件：内容为 `4C 69 6E 65 31 0A 4C 69 6E 65 32`（`\n` 对应 `0A`）。  


### 五、总结：如何正确选 `mode`？
1. **只读已存在文件** → `r`（文本）/`rb`（二进制）  
2. **新建/覆盖文件（只写）** → `w`（文本）/`wb`（二进制）  
3. **追加写入文件（只写）** → `a`（文本）/`ab`（二进制）  
4. **读写已存在文件** → `r+`（文本）/`r+b`（二进制）  
5. **新建/覆盖文件（读写）** → `w+`（文本）/`w+b`（二进制）  
6. **追加写入并需读旧内容** → `a+`（文本）/`a+b`（二进制）  

**核心原则**：根据文件类型（文本/二进制）和操作需求（创建/覆盖/追加）选择，跨平台代码优先用二进制模式（加 `b`）避免换行问题。



### 逐一讲解

### 定位 API

||||||
|-|-|-|-|-|
|**创建文件**|**刷新磁盘**|**关闭文件**|**写文件**|**读文件**|
|fopen|fflush|fclose|fwrite|fread|
||||fputc|fgetc|
||||fputs|fgets|
||||fprintf|fscanf|
||||||
||||||
||||||